<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Outfit Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .results {
            margin-top: 20px;
        }
        .outfit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .outfit-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            background: white;
        }
        .outfit-card h3 {
            margin-top: 0;
            color: #333;
        }
        .outfit-card p {
            margin: 5px 0;
            color: #666;
        }
        .error {
            color: #dc3545;
            margin-top: 10px;
        }
        .success {
            color: #28a745;
            margin-top: 10px;
        }
        .loading {
            display: none;
            margin: 20px 0;
            text-align: center;
        }
        .loading::after {
            content: "Loading...";
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: "Loading"; }
            40% { content: "Loading."; }
            60% { content: "Loading.."; }
            80%, 100% { content: "Loading..."; }
        }
        .context-info {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .context-info h4 {
            color: #333;
            margin: 0 0 5px 0;
        }
        .context-info p {
            margin: 3px 0;
        }
        .outfit-section {
            margin: 20px 0;
            padding: 15px;
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .item-description {
            font-size: 1.1em;
            color: #333;
            margin: 10px 0;
            font-style: italic;
        }
        .item-details {
            color: #666;
            line-height: 1.6;
            margin-left: 15px;
        }
        .item-details p {
            margin: 5px 0;
        }
        .api-test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .request-response-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .request-container, .response-container {
            flex: 1;
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .request-container pre, .response-container pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 0;
        }
        .copy-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .copy-button:hover {
            background: #5a6268;
        }
        .endpoint-selector {
            margin-bottom: 15px;
        }
        .endpoint-selector select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fashion Outfit Generator</h1>
        
        <div class="section">
            <h2>User Profile</h2>
            <div class="form-group">
                <label>Measurement System:</label>
                <select id="measurementSystem">
                    <option value="metric">Metric (cm)</option>
                    <option value="imperial">Imperial (inches)</option>
                    <option value="asia">Asia (cm)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Height:</label>
                <input type="number" id="height" step="0.1">
            </div>
            <div class="form-group">
                <label>Weight:</label>
                <input type="number" id="weight" step="0.1">
            </div>
            <div class="form-group">
                <label>Bust:</label>
                <input type="number" id="bust" step="0.1">
            </div>
            <div class="form-group">
                <label>Cup Size:</label>
                <select id="cupSize">
                    <option value="AA">AA</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="DD">DD</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                </select>
            </div>
            <div class="form-group">
                <label>Waist:</label>
                <input type="number" id="waist" step="0.1">
            </div>
            <div class="form-group">
                <label>Hips:</label>
                <input type="number" id="hips" step="0.1">
            </div>
            <div class="form-group">
                <label>Shoulder Width:</label>
                <input type="number" id="shoulderWidth" step="0.1">
            </div>
            <div class="form-group">
                <label>Arm Length:</label>
                <input type="number" id="armLength" step="0.1">
            </div>
            <div class="form-group">
                <label>Inseam:</label>
                <input type="number" id="inseam" step="0.1">
            </div>
            <div class="form-group">
                <label>Shoe Size:</label>
                <input type="number" id="shoeSize" step="0.1">
            </div>
            <div class="form-group">
                <label>Favorite Colors (comma-separated):</label>
                <input type="text" id="favoriteColors" placeholder="e.g., black, white, navy">
            </div>
            <div class="form-group">
                <label>Preferred Materials (comma-separated):</label>
                <input type="text" id="preferredMaterials" placeholder="e.g., cotton, silk, wool">
            </div>
            <div class="form-group">
                <label>Style Adaptability (1-10):</label>
                <input type="range" id="styleAdaptability" min="1" max="10" value="7">
                <span id="styleAdaptabilityValue">7</span>
            </div>
            <div class="form-group">
                <label>Comfort Priority (1-10):</label>
                <input type="range" id="comfortPriority" min="1" max="10" value="5">
                <span id="comfortPriorityValue">5</span>
            </div>
            <div class="form-group">
                <label>Modesty Level (1-10):</label>
                <input type="range" id="modestyLevel" min="1" max="10" value="5">
                <span id="modestyLevelValue">5</span>
            </div>
            <div class="form-group">
                <label>Elegance Level (1-10):</label>
                <input type="range" id="eleganceLevel" min="1" max="10" value="5">
                <span id="eleganceLevelValue">5</span>
            </div>
            <div class="form-group">
                <label>Comfort Level (1-10):</label>
                <input type="range" id="comfortLevel" min="1" max="10" value="7">
                <span id="comfortLevelValue">7</span>
            </div>
            <div class="form-group">
                <label>Heel Height Preference (cm):</label>
                <input type="number" id="heelHeightPreference" step="0.1" value="5">
            </div>
            <div class="form-group">
                <label>Heel Width Preference:</label>
                <select id="heelWidthPreference">
                    <option value="narrow">Narrow</option>
                    <option value="medium" selected>Medium</option>
                    <option value="wide">Wide</option>
                </select>
            </div>
            <div class="form-group">
                <label>Open Toe Preference:</label>
                <select id="openToePreference">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                </select>
            </div>
            <button onclick="updateProfile()">Update Profile</button>
        </div>

        <div class="section">
            <h2>Event Context</h2>
            <div class="form-group">
                <label>Event Type:</label>
                <select id="eventType">
                    <option value="casual">Casual</option>
                    <option value="formal">Formal</option>
                </select>
            </div>
            <div class="form-group">
                <label>Formality Level (1-10):</label>
                <input type="range" id="formalityLevel" min="1" max="10" value="5">
                <span id="formalityLevelValue">5</span>
            </div>
            <div class="form-group">
                <label>Time of Day:</label>
                <select id="timeOfDay">
                    <option value="morning">Morning</option>
                    <option value="afternoon">Afternoon</option>
                    <option value="evening">Evening</option>
                    <option value="night">Night</option>
                </select>
            </div>
            <div class="form-group">
                <label>Season:</label>
                <select id="season">
                    <option value="spring">Spring</option>
                    <option value="summer">Summer</option>
                    <option value="autumn">Autumn</option>
                    <option value="winter">Winter</option>
                    <option value="all">All Seasons</option>
                </select>
            </div>
            <div class="form-group">
                <label>Location:</label>
                <select id="location">
                    <option value="indoor">Indoor</option>
                    <option value="outdoor">Outdoor</option>
                    <option value="both">Both</option>
                </select>
            </div>
            <div class="form-group">
                <label>Duration:</label>
                <select id="duration">
                    <option value="short">Short (1-2 hours)</option>
                    <option value="medium">Medium (2-4 hours)</option>
                    <option value="long">Long (4+ hours)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Activities (comma-separated):</label>
                <input type="text" id="activities" placeholder="e.g., walking, dancing, sitting">
            </div>
            <div class="form-group">
                <label>Weather:</label>
                <select id="weather">
                    <option value="sunny">Sunny</option>
                    <option value="cloudy">Cloudy</option>
                    <option value="rainy">Rainy</option>
                    <option value="snowy">Snowy</option>
                    <option value="mild">Mild</option>
                </select>
            </div>
            <div class="form-group">
                <label>Temperature:</label>
                <select id="temperature">
                    <option value="cold">Cold</option>
                    <option value="cool">Cool</option>
                    <option value="mild">Mild</option>
                    <option value="warm">Warm</option>
                    <option value="hot">Hot</option>
                    <option value="room">Room Temperature</option>
                </select>
            </div>
            <div class="form-group">
                <label>Movement Level:</label>
                <select id="movementLevel">
                    <option value="low">Low</option>
                    <option value="moderate">Moderate</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div class="form-group">
                <label>Cultural Context:</label>
                <select id="culturalContext">
                    <option value="western">Western</option>
                    <option value="eastern">Eastern</option>
                    <option value="middle_eastern">Middle Eastern</option>
                    <option value="african">African</option>
                    <option value="latin">Latin</option>
                </select>
            </div>
            <div class="form-group">
                <label>Dress Code:</label>
                <select id="dressCode">
                    <option value="casual">Casual</option>
                    <option value="business_casual">Business Casual</option>
                    <option value="business">Business</option>
                    <option value="semi_formal">Semi-Formal</option>
                    <option value="formal">Formal</option>
                    <option value="black_tie">Black Tie</option>
                </select>
            </div>
            <div class="form-group">
                <label>Social Interactions:</label>
                <select id="socialInteractions">
                    <option value="general">General</option>
                    <option value="professional">Professional</option>
                    <option value="intimate">Intimate</option>
                    <option value="public">Public</option>
                </select>
            </div>
        </div>

        <div class="section">
            <h2>Generate Outfit</h2>
            <button onclick="generateOutfit()">Generate Complete Outfit</button>
            <button onclick="generateTop()">Generate Top Only</button>
            <button onclick="generateBottom()">Generate Bottom Only</button>
            <button onclick="generateShoes()">Generate Shoes Only</button>
            <div class="loading" id="loading"></div>
            <div class="results" id="results"></div>
        </div>

        <div class="section">
            <h2>API Testing Interface</h2>
            <div class="api-test-section">
                <div class="endpoint-selector">
                    <label>Select Endpoint:</label>
                    <select id="endpointSelect">
                        <option value="/api/generate/complete-outfit">Complete Outfit</option>
                        <option value="/api/generate/top">Top Only</option>
                        <option value="/api/generate/bottom">Bottom Only</option>
                        <option value="/api/generate/shoes">Shoes Only</option>
                    </select>
                </div>
                <div class="request-response-container">
                    <div class="request-container">
                        <h4>Request Payload</h4>
                        <pre id="requestPayload"></pre>
                        <button class="copy-button" onclick="copyAsCurl()">Copy as cURL</button>
                    </div>
                    <div class="response-container">
                        <h4>Response</h4>
                        <pre id="responsePayload"></pre>
                    </div>
                </div>
                <button onclick="testEndpoint()">Test Selected Endpoint</button>
            </div>
        </div>
    </div>

    <script>
        // Default measurements
        const defaultMeasurements = {
            height: 165,
            weight: 60,
            bust: 85,
            cup_size: 'B',
            waist: 70,
            hips: 90,
            shoulder_width: 38,
            arm_length: 58,
            inseam: 76,
            shoe_size: 38,
            favorite_colors: 'black, white, navy',
            preferred_materials: 'cotton, silk, wool',
            style_adaptability: 7,
            comfort_priority: 5,
            modesty_level: 5,
            elegance_level: 5,
            heel_height_preference: 5,
            heel_width_preference: 'medium',
            open_toe_preference: 'false'
        };

        // Load default measurements on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            
            // Add event listeners for range inputs
            document.querySelectorAll('input[type="range"]').forEach(input => {
                input.addEventListener('input', function() {
                    const valueDisplay = document.getElementById(this.id + 'Value');
                    if (valueDisplay) {
                        valueDisplay.textContent = this.value;
                    }
                });
            });
        });

        // Measurement system conversion
        document.getElementById('measurementSystem').addEventListener('change', function() {
            const system = this.value;
            const inputs = ['height', 'weight', 'bust', 'waist', 'hips', 'shoulderWidth', 'armLength', 'inseam', 'shoeSize'];
            
            inputs.forEach(input => {
                const value = document.getElementById(input).value;
                if (value) {
                    if (system === 'imperial') {
                        // Convert to inches
                        document.getElementById(input).value = (parseFloat(value) / 2.54).toFixed(1);
                    } else {
                        // Convert to cm
                        document.getElementById(input).value = (parseFloat(value) * 2.54).toFixed(1);
                    }
                }
            });
        });

        function updateProfile() {
            const profile = {
                measurement_system: document.getElementById('measurementSystem').value,
                height: parseFloat(document.getElementById('height').value),
                weight: parseFloat(document.getElementById('weight').value),
                bust: parseFloat(document.getElementById('bust').value),
                cup_size: document.getElementById('cupSize').value,
                waist: parseFloat(document.getElementById('waist').value),
                hips: parseFloat(document.getElementById('hips').value),
                shoulder_width: parseFloat(document.getElementById('shoulderWidth').value),
                arm_length: parseFloat(document.getElementById('armLength').value),
                inseam: parseFloat(document.getElementById('inseam').value),
                shoe_size: parseFloat(document.getElementById('shoeSize').value),
                favorite_colors: document.getElementById('favoriteColors').value.split(',').map(c => c.trim()),
                preferred_materials: document.getElementById('preferredMaterials').value.split(',').map(m => m.trim()),
                style_adaptability: parseInt(document.getElementById('styleAdaptability').value),
                comfort_priority: parseInt(document.getElementById('comfortPriority').value),
                modesty_level: parseInt(document.getElementById('modestyLevel').value),
                elegance_level: parseInt(document.getElementById('eleganceLevel').value),
                heel_height_preference: parseFloat(document.getElementById('heelHeightPreference').value),
                heel_width_preference: document.getElementById('heelWidthPreference').value,
                open_toe_preference: document.getElementById('openToePreference').value === 'true',
                comfort_level: parseInt(document.getElementById('comfortLevel').value)
            };
            
            localStorage.setItem('userProfile', JSON.stringify(profile));
            alert('Profile updated successfully!');
        }

        function getEventContext() {
            return {
                event_type: document.getElementById('eventType').value,
                formality_level: parseInt(document.getElementById('formalityLevel').value),
                weather_conditions: [document.getElementById('weather').value],
                time_of_day: document.getElementById('timeOfDay').value,
                season: document.getElementById('season').value,
                location: document.getElementById('location').value,
                duration: parseInt(document.getElementById('duration').value === 'short' ? 2 : 
                                 document.getElementById('duration').value === 'medium' ? 4 : 6),
                activity_level: document.getElementById('movementLevel').value === 'low' ? 1 :
                               document.getElementById('movementLevel').value === 'moderate' ? 2 : 3
            };
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function getUserProfile() {
            try {
                const getValue = (id, defaultValue) => {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.warn(`Element with id ${id} not found`);
                        return defaultValue;
                    }
                    return element.value || defaultValue;
                };

                const getFloat = (id, defaultValue) => {
                    const value = getValue(id, defaultValue);
                    return value ? parseFloat(value) : defaultValue;
                };

                const getInt = (id, defaultValue) => {
                    const value = getValue(id, defaultValue);
                    return value ? parseInt(value) : defaultValue;
                };

                const getArray = (id, defaultValue) => {
                    const value = getValue(id, defaultValue.join(','));
                    return value ? value.split(',').map(item => item.trim()) : defaultValue;
                };

                return {
                    height: getFloat('height', 165),
                    weight: getFloat('weight', 60),
                    bust: getFloat('bust', 85),
                    waist: getFloat('waist', 70),
                    hips: getFloat('hips', 90),
                    inseam: getFloat('inseam', 76),
                    shoe_size: getFloat('shoeSize', 38),
                    comfort_level: getInt('comfortLevel', 7),
                    style_preferences: getArray('preferredMaterials', ['cotton', 'silk']),
                    color_preferences: getArray('favoriteColors', ['black', 'white']),
                    fit_preferences: ['regular']  // Default fit preference
                };
            } catch (error) {
                console.error('Error getting user profile:', error);
                return {
                    height: 165,
                    weight: 60,
                    bust: 85,
                    waist: 70,
                    hips: 90,
                    inseam: 76,
                    shoe_size: 38,
                    comfort_level: 7,
                    style_preferences: ['cotton', 'silk'],
                    color_preferences: ['black', 'white'],
                    fit_preferences: ['regular']
                };
            }
        }

        function displayResults(response) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            if (!response || !response.data) {
                resultsDiv.innerHTML = '<div class="error">No outfit data received</div>';
                return;
            }

            const outfitGrid = document.createElement('div');
            outfitGrid.className = 'outfit-grid';
            
            const outfitCard = document.createElement('div');
            outfitCard.className = 'outfit-card';
            
            // Add user profile and event context info
            const userProfile = getUserProfile();
            const eventContext = getEventContext();
            
            let contextHtml = `
                <div class="context-info">
                    <h4>User Profile</h4>
                    <p>Height: ${userProfile.height}cm | Weight: ${userProfile.weight}kg</p>
                    <p>Measurements: Bust ${userProfile.bust}cm | Waist ${userProfile.waist}cm | Hips ${userProfile.hips}cm</p>
                    <p>Style Preferences: ${userProfile.style_preferences.join(', ')}</p>
                    <p>Color Preferences: ${userProfile.color_preferences.join(', ')}</p>
                    <p>Comfort Level: ${userProfile.comfort_level}/10</p>
                </div>
                <div class="context-info">
                    <h4>Event Context</h4>
                    <p>Type: ${eventContext.event_type} | Formality: ${eventContext.formality_level}/10</p>
                    <p>Time: ${eventContext.time_of_day} | Season: ${eventContext.season}</p>
                    <p>Location: ${eventContext.location} | Duration: ${eventContext.duration} hours</p>
                    <p>Weather: ${eventContext.weather_conditions.join(', ')}</p>
                    <p>Activity Level: ${eventContext.activity_level}/3</p>
                </div>
            `;
            
            let outfitHtml = '<h3>Generated Outfit</h3>';
            
            // Handle complete outfit response
            if (response.data.top && response.data.bottom && response.data.shoes) {
                outfitHtml += `
                    <div class="outfit-details">
                        <div class="outfit-component">
                            <h4>Top</h4>
                            <p>Type: ${response.data.top.type}</p>
                            <p>Color: ${response.data.top.color}</p>
                            <p>Material: ${response.data.top.material}</p>
                            <p>Fit: ${response.data.top.fit}</p>
                            ${response.data.top.hem ? `<p>Hem: ${response.data.top.hem}</p>` : ''}
                        </div>
                        <div class="outfit-component">
                            <h4>Bottom</h4>
                            <p>Type: ${response.data.bottom.type}</p>
                            <p>Color: ${response.data.bottom.color}</p>
                            <p>Material: ${response.data.bottom.material}</p>
                            <p>Fit: ${response.data.bottom.fit}</p>
                            ${response.data.bottom.length ? `<p>Length: ${response.data.bottom.length}</p>` : ''}
                        </div>
                        <div class="outfit-component">
                            <h4>Shoes</h4>
                            <p>Type: ${response.data.shoes.type}</p>
                            <p>Color: ${response.data.shoes.color}</p>
                            <p>Material: ${response.data.shoes.material}</p>
                            <p>Fit: ${response.data.shoes.fit}</p>
                        </div>
                    </div>
                `;
            }
            
            outfitCard.innerHTML = contextHtml + outfitHtml;
            outfitGrid.appendChild(outfitCard);
            resultsDiv.appendChild(outfitGrid);
        }

        async function generateOutfit() {
            try {
                const userProfile = getUserProfile();
                const eventContext = getEventContext();
                
                const response = await fetch('http://localhost:8001/api/generate/complete-outfit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        user_profile: userProfile,
                        event_context: eventContext
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to generate outfit');
                }
                
                const result = await response.json();
                if (!result.outfit) {
                    throw new Error('Invalid response format: missing outfit data');
                }
                
                // Display the generated outfit with full details
                const outfit = result.outfit;
                displayResults(result);
            } catch (error) {
                console.error('Error generating outfit:', error);
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = `<div class="error">Error generating outfit: ${error.message}</div>`;
            }
        }

        async function generateTop() {
            try {
                const userProfile = getUserProfile();
                const eventContext = getEventContext();
                
                const response = await fetch('http://localhost:8001/api/generate/top', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        user_profile: userProfile,
                        event_context: eventContext
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to generate top');
                }
                
                const result = await response.json();
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        async function generateBottom() {
            try {
                const userProfile = getUserProfile();
                const eventContext = getEventContext();
                
                const response = await fetch('http://localhost:8001/api/generate/bottom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        user_profile: userProfile,
                        event_context: eventContext
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to generate bottom');
                }
                
                const result = await response.json();
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        async function generateShoes() {
            try {
                const userProfile = getUserProfile();
                const eventContext = getEventContext();
                
                const response = await fetch('http://localhost:8001/api/generate/shoes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        user_profile: userProfile,
                        event_context: eventContext
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to generate shoes');
                }
                
                const result = await response.json();
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Add this function to initialize form values
        function initializeForm() {
            const defaultValues = {
                height: 165,
                weight: 60,
                bust: 85,
                cupSize: 'B',
                waist: 70,
                hips: 90,
                shoulderWidth: 38,
                armLength: 58,
                inseam: 76,
                shoeSize: 38,
                favoriteColors: 'black, white, navy',
                preferredMaterials: 'cotton, silk, wool',
                styleAdaptability: 7,
                comfortPriority: 5,
                modestyLevel: 5,
                eleganceLevel: 5,
                heelHeightPreference: 5,
                heelWidthPreference: 'medium',
                openToePreference: 'false',
                comfortLevel: 7
            };

            // Set default values for all inputs
            Object.entries(defaultValues).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    if (element.type === 'range') {
                        element.value = value;
                        const valueDisplay = document.getElementById(id + 'Value');
                        if (valueDisplay) {
                            valueDisplay.textContent = value;
                        }
                    } else {
                        element.value = value;
                    }
                }
            });
        }

        function updateRequestPayload() {
            const userProfile = getUserProfile();
            const eventContext = getEventContext();
            const payload = {
                user_profile: userProfile,
                event_context: eventContext
            };
            document.getElementById('requestPayload').textContent = JSON.stringify(payload, null, 2);
        }

        function copyAsCurl() {
            const endpoint = document.getElementById('endpointSelect').value;
            const payload = document.getElementById('requestPayload').textContent;
            const curl = `curl -X POST http://localhost:8001${endpoint} \\
    -H "Content-Type: application/json" \\
    -H "Accept: application/json" \\
    -d '${payload}'`;
            
            navigator.clipboard.writeText(curl).then(() => {
                alert('cURL command copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy cURL command:', err);
            });
        }

        async function testEndpoint() {
            try {
                const endpoint = document.getElementById('endpointSelect').value;
                const userProfile = getUserProfile();
                const eventContext = getEventContext();
                
                showLoading();
                
                const response = await fetch(`http://localhost:8001${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        user_profile: userProfile,
                        event_context: eventContext
                    })
                });
                
                const result = await response.json();
                document.getElementById('responsePayload').textContent = JSON.stringify(result, null, 2);
                
                if (response.ok) {
                    displayResults(result);
                } else {
                    throw new Error(result.detail || 'API request failed');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('responsePayload').textContent = `Error: ${error.message}`;
                document.getElementById('results').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            } finally {
                hideLoading();
            }
        }

        // Update request payload when form values change
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', updateRequestPayload);
        });

        // Initialize request payload on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            updateRequestPayload();
            
            // Add event listeners for range inputs
            document.querySelectorAll('input[type="range"]').forEach(input => {
                input.addEventListener('input', function() {
                    const valueDisplay = document.getElementById(this.id + 'Value');
                    if (valueDisplay) {
                        valueDisplay.textContent = this.value;
                    }
                    updateRequestPayload();
                });
            });
        });
    </script>
</body>
</html> 